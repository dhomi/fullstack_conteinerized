{% extends "homepage.html" %}

{% block title %}Create New Order{% endblock %}

{% block content %}
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<div class="container" style="margin-top: 20px;">
  <h2>Create New Order</h2>

  <form id="orderForm" onsubmit="return false;">
    <div class="form-group">
      <label for="order_number">Order Number:</label>
      <input type="number" class="form-control" id="order_number" name="order_number" required>
    </div>
    <div class="form-group">
      <label for="supplier_code">Supplier Code:</label>
      <input type="number" class="form-control" id="supplier_code" name="supplier_code" required>
    </div>
    <div class="form-group">
      <label for="amount">Amount:</label>
      <input type="number" step="0.01" class="form-control" id="amount" name="amount" required>
    </div>
    <div class="form-group">
      <label for="order_date">Order Date:</label>
      <input type="date" class="form-control" id="order_date" name="order_date" required>
    </div>
    <div class="form-group">
      <label for="delivery_date">Delivery Date:</label>
      <input type="date" class="form-control" id="delivery_date" name="delivery_date" required>
    </div>
    <div class="form-group">
      <label for="status">Status:</label>
      <input type="text" class="form-control" id="status" name="status" required>
    </div>

    <!-- Click triggers submitOrder() below -->
    <button type="button" class="btn btn-primary" onclick="submitOrder()">Create Order</button>
  </form>
</div>

<script>
  // Only needed if jQuery / CSRF logic isn't already in homepage.html
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');

  function submitOrder() {
    const orderData = {
      order_number: document.getElementById('order_number').value,
      supplier_code: document.getElementById('supplier_code').value,
      amount: parseFloat(document.getElementById('amount').value),
      order_date: document.getElementById('order_date').value,
      delivery_date: document.getElementById('delivery_date').value,
      status: document.getElementById('status').value,
    };

    $.ajax({
      // Point to your Django or FastAPI endpoint (typically a Django view first if you do proxy logic)
      url: "/ordermanagement/create/",
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(orderData),
      headers: {
        'X-CSRFToken': csrftoken
      },
      success: function(response) {
        alert('Order created successfully!');
        window.location.href = '/ordermanagement/orders'; // or wherever you want to go
      },
      error: function(err) {
        alert('Failed to create order: ' + err.responseText);
        console.error(err);
      }
    });
  }
</script>
{% endblock %}
