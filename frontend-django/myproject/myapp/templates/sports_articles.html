{% extends 'homepage.html' %}

{% block title %}Sporting Articles{% endblock %}

{% block content %}
<meta name="description" content="Bootstrap table for managing sports articles.">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
<script type="text/javascript" src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

<div class="container" style="margin-top: 1px;">
    <h2>Sporting Articles</h2>

    <table id="sportsArticlesTable" class="table table-striped table-bordered table-sm">
        <thead>
            <tr>
                <th>Product Code</th>
                <th>Product Name</th>
                <th>Category</th>
                <th>Size</th>
                <th>Color</th>
                <th>Price</th>
                <th>Stock Quantity</th>
                <th>Stock Minimum</th>
                <th>VAT Type</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for sportartikel in sports_articles %}
                <tr id="row-{{ sportartikel.article_code }}">
                    <td>{{ sportartikel.article_code }}</td>
                    <td contenteditable="true" class="editable" data-field="article_name">{{ sportartikel.article_name }}</td>
                    <td contenteditable="true" class="editable" data-field="category">{{ sportartikel.category }}</td>
                    <td contenteditable="true" class="editable" data-field="size">{{ sportartikel.size }}</td>
                    <td contenteditable="true" class="editable" data-field="color">{{ sportartikel.color }}</td>
                    <td contenteditable="true" class="editable" data-field="price">{{ sportartikel.price }}</td>
                    <td contenteditable="true" class="editable" data-field="stock_quantity">{{ sportartikel.stock_quantity }}</td>
                    <td contenteditable="true" class="editable" data-field="stock_min">{{ sportartikel.stock_min }}</td>
                    <td contenteditable="true" class="editable" data-field="vat_type">{{ sportartikel.vat_type }}</td>
                    <td>
                        <div style="display: flex; gap: 2px;">
                            <button class="btn btn-primary btn-sm" onclick="updateArticle({{ sportartikel.article_code }})">Update</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteArticle({{ sportartikel.article_code }})">Delete</button>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    
    </table>
</div>

<script>
    $(document).ready(function () {
        $('#sportsArticlesTable').DataTable({
            "scrollY": "60vh",
            "scrollCollapse": true,
            "paging": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": false
        });
        $('.dataTables_length').addClass('bs-select');
    });

    // Function to update an article
    function updateArticle(articleCode) {
        const row = document.getElementById(`row-${articleCode}`);
        const updatedData = {};

        // Collect all editable fields
        $(row).find('.editable').each(function () {
            const field = $(this).data('field');
            const value = $(this).text().trim();
            updatedData[field] = value;
        });

        $.ajax({
            url: `http://localhost:8000/sports_articles/${articleCode}`,
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(updatedData),
            success: function (response) {
                alert('Article updated successfully!');
                location.reload();
            },
            error: function (err) {
                alert('Failed to update article: ' + err.responseText);
            }
        });
    }

    // Function to delete an article
    function deleteArticle(articleCode) {
        if (confirm('Are you sure you want to delete this article?')) {
            $.ajax({
                url: `http://localhost:8000/sports_articles/${articleCode}`,
                type: 'DELETE',
                success: function (response) {
                    alert('Article deleted successfully!');
                    location.reload();
                },
                error: function (err) {
                    alert('Failed to delete article: ' + err.responseText);
                }
            });
        }
    }
</script>
{% endblock %}
