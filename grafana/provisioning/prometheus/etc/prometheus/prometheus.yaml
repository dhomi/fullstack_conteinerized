global:
  evaluation_interval: 30s
  scrape_interval: 30s
  external_labels:
    prometheus: monitoring/kube-prom-stack-kube-prome-prometheus
    prometheus_replica: prometheus-kube-prom-stack-kube-prome-prometheus-0
rule_files:
  - /etc/prometheus/rules/prometheus-kube-prom-stack-kube-prome-prometheus-rulefiles-0/*.yaml
scrape_configs:
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-alertmanager/0
    honor_labels: false
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - monitoring
    metrics_path: /metrics
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app
          - __meta_kubernetes_service_labelpresent_app
        regex: (kube-prometheus-stack-alertmanager);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_release
          - __meta_kubernetes_service_labelpresent_release
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_self_monitor
          - __meta_kubernetes_service_labelpresent_self_monitor
        regex: (true);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: http-web
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - target_label: endpoint
        replacement: http-web
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-apiserver/0
    honor_labels: false
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - default
    scheme: https
    tls_config:
      insecure_skip_verify: false
      server_name: kubernetes
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_component
          - __meta_kubernetes_service_labelpresent_component
        regex: (apiserver);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_provider
          - __meta_kubernetes_service_labelpresent_provider
        regex: (kubernetes);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: https
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_component
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: https
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-coredns/0
    honor_labels: false
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - kube-system
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app
          - __meta_kubernetes_service_labelpresent_app
        regex: (kube-prometheus-stack-coredns);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_release
          - __meta_kubernetes_service_labelpresent_release
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: http-metrics
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_jobLabel
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: http-metrics
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-kube-controller-manager/0
    honor_labels: false
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - kube-system
    scheme: https
    tls_config:
      insecure_skip_verify: true
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app
          - __meta_kubernetes_service_labelpresent_app
        regex: (kube-prometheus-stack-kube-controller-manager);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_release
          - __meta_kubernetes_service_labelpresent_release
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: http-metrics
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_jobLabel
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: http-metrics
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-kube-proxy/0
    honor_labels: false
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - kube-system
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app
          - __meta_kubernetes_service_labelpresent_app
        regex: (kube-prometheus-stack-kube-proxy);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_release
          - __meta_kubernetes_service_labelpresent_release
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: http-metrics
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_jobLabel
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: http-metrics
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-kubelet/0
    honor_labels: true
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - kube-system
    scheme: https
    tls_config:
      insecure_skip_verify: true
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app_kubernetes_io_name
          - __meta_kubernetes_service_labelpresent_app_kubernetes_io_name
        regex: (kubelet);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_k8s_app
          - __meta_kubernetes_service_labelpresent_k8s_app
        regex: (kubelet);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: https-metrics
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_k8s_app
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: https-metrics
      - source_labels:
          - __metrics_path__
        target_label: metrics_path
        action: replace
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-kubelet/1
    honor_labels: true
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - kube-system
    metrics_path: /metrics/cadvisor
    scheme: https
    tls_config:
      insecure_skip_verify: true
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app_kubernetes_io_name
          - __meta_kubernetes_service_labelpresent_app_kubernetes_io_name
        regex: (kubelet);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_k8s_app
          - __meta_kubernetes_service_labelpresent_k8s_app
        regex: (kubelet);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: https-metrics
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_k8s_app
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: https-metrics
      - source_labels:
          - __metrics_path__
        target_label: metrics_path
        action: replace
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-kubelet/2
    honor_labels: true
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - kube-system
    metrics_path: /metrics/probes
    scheme: https
    tls_config:
      insecure_skip_verify: true
      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app_kubernetes_io_name
          - __meta_kubernetes_service_labelpresent_app_kubernetes_io_name
        regex: (kubelet);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_k8s_app
          - __meta_kubernetes_service_labelpresent_k8s_app
        regex: (kubelet);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: https-metrics
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_k8s_app
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: https-metrics
      - source_labels:
          - __metrics_path__
        target_label: metrics_path
        action: replace
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-operator/0
    honor_labels: true
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - monitoring
    scheme: https
    tls_config:
      insecure_skip_verify: false
      ca_file: /etc/prometheus/certs/secret_monitoring_kube-prom-stack-kube-prome-admission_ca
      server_name: kube-prom-stack-kube-prome-operator
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app
          - __meta_kubernetes_service_labelpresent_app
        regex: (kube-prometheus-stack-operator);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_release
          - __meta_kubernetes_service_labelpresent_release
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: https
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - target_label: endpoint
        replacement: https
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-prome-prometheus/0
    honor_labels: false
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - monitoring
    metrics_path: /metrics
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app
          - __meta_kubernetes_service_labelpresent_app
        regex: (kube-prometheus-stack-prometheus);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_release
          - __meta_kubernetes_service_labelpresent_release
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_self_monitor
          - __meta_kubernetes_service_labelpresent_self_monitor
        regex: (true);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: http-web
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - target_label: endpoint
        replacement: http-web
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-kube-state-metrics/0
    honor_labels: true
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - monitoring
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app_kubernetes_io_instance
          - __meta_kubernetes_service_labelpresent_app_kubernetes_io_instance
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app_kubernetes_io_name
          - __meta_kubernetes_service_labelpresent_app_kubernetes_io_name
        regex: (kube-state-metrics);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: http
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_app_kubernetes_io_name
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: http
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
  - job_name: serviceMonitor/monitoring/kube-prom-stack-prometheus-node-exporter/0
    honor_labels: false
    kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
            - monitoring
    scheme: http
    relabel_configs:
      - source_labels:
          - job
        target_label: __tmp_prometheus_job_name
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_app
          - __meta_kubernetes_service_labelpresent_app
        regex: (prometheus-node-exporter);true
      - action: keep
        source_labels:
          - __meta_kubernetes_service_label_release
          - __meta_kubernetes_service_labelpresent_release
        regex: (kube-prom-stack);true
      - action: keep
        source_labels:
          - __meta_kubernetes_endpoint_port_name
        regex: http-metrics
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Node;(.*)
        replacement: ${1}
        target_label: node
      - source_labels:
          - __meta_kubernetes_endpoint_address_target_kind
          - __meta_kubernetes_endpoint_address_target_name
        separator: ;
        regex: Pod;(.*)
        replacement: ${1}
        target_label: pod
      - source_labels:
          - __meta_kubernetes_namespace
        target_label: namespace
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: service
      - source_labels:
          - __meta_kubernetes_pod_name
        target_label: pod
      - source_labels:
          - __meta_kubernetes_pod_container_name
        target_label: container
      - source_labels:
          - __meta_kubernetes_service_name
        target_label: job
        replacement: ${1}
      - source_labels:
          - __meta_kubernetes_service_label_jobLabel
        target_label: job
        regex: (.+)
        replacement: ${1}
      - target_label: endpoint
        replacement: http-metrics
      - source_labels:
          - __address__
        target_label: __tmp_hash
        modulus: 1
        action: hashmod
      - source_labels:
          - __tmp_hash
        regex: 0
        action: keep
    metric_relabel_configs: []
alerting:
  alert_relabel_configs:
    - action: labeldrop
      regex: prometheus_replica
  alertmanagers:
    - path_prefix: /
      scheme: http
      kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
              - monitoring
      api_version: v2
      relabel_configs:
        - action: keep
          source_labels:
            - __meta_kubernetes_service_name
          regex: kube-prom-stack-kube-prome-alertmanager
        - action: keep
          source_labels:
            - __meta_kubernetes_endpoint_port_name
          regex: http-web
